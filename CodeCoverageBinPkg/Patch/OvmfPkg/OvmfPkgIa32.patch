Index: OvmfPkgIa32.dsc
===================================================================
--- OvmfPkgIa32.dsc	(revision 14443)
+++ OvmfPkgIa32.dsc	(working copy)
@@ -350,6 +350,17 @@
       PcdLib|MdePkg/Library/BasePcdLibNull/BasePcdLibNull.inf
   }
   IntelFrameworkModulePkg/Universal/StatusCode/Pei/StatusCodePei.inf
+  #
+  # Code Coverage module
+  #
+!ifdef $(ENCOV) 
+  CodeCoverageBinPkg/CodeCoveragePei/CodeCoveragePei.inf {
+    <LibraryClasses>
+    !if $(ITSCOV_VS2008_ENABLE) == TRUE
+	  CodeCoveragePeimLib|CodeCoverageBinPkg/Library/VS2008/CodeCoveragePeimLib/CodeCoveragePeimLib.inf
+    !endif
+  }
+!endif
   MdeModulePkg/Core/DxeIplPeim/DxeIpl.inf
 
   OvmfPkg/PlatformPei/PlatformPei.inf {
@@ -364,7 +375,23 @@
     <LibraryClasses>
       NULL|IntelFrameworkModulePkg/Library/LzmaCustomDecompressLib/LzmaCustomDecompressLib.inf
   }
-
+  #
+  # Code Coverage module
+  #
+!ifdef $(ENCOV) 
+  CodeCoverageBinPkg/CodeCoverageDxe/CodeCoverageDxe.inf {
+    <LibraryClasses>
+    !if $(ITSCOV_VS2008_ENABLE) == TRUE
+	  CodeCoverageDriverLib|CodeCoverageBinPkg/Library/VS2008/CodeCoverageDriverLib/CodeCoverageDriverLib.inf
+    !endif
+  }
+  CodeCoverageBinPkg/CovResetSystem/CovResetSystem.inf {
+    <LibraryClasses>
+    !if $(ITSCOV_VS2008_ENABLE) == TRUE
+	  CovResetSystemLib|CodeCoverageBinPkg/Library/VS2008/CovResetSystemLib/CovResetSystemLib.inf
+    !endif
+  }
+!endif
   IntelFrameworkModulePkg/Universal/StatusCode/RuntimeDxe/StatusCodeRuntimeDxe.inf
   MdeModulePkg/Universal/PCD/Dxe/Pcd.inf  {
    <LibraryClasses>
Index: OvmfPkgIa32.fdf
===================================================================
--- OvmfPkgIa32.fdf	(revision 14443)
+++ OvmfPkgIa32.fdf	(working copy)
@@ -35,10 +35,10 @@
 BlockSize     = 0x1000
 NumBlocks     = 0x200
 
-0x00000000|0x001CC000
+0x00000000|0x001EC000
 FV = FVMAIN_COMPACT
 
-0x001CC000|0x34000
+0x001EC000|0x14000
 FV = SECFV
 !endif
 
@@ -125,6 +125,13 @@
 INF  MdeModulePkg/Universal/PCD/Pei/Pcd.inf
 INF  IntelFrameworkModulePkg/Universal/StatusCode/Pei/StatusCodePei.inf
 INF  OvmfPkg/PlatformPei/PlatformPei.inf
+!ifdef $(ENCOV)
+  !ifdef $(BINARY_ONLY)
+    INF  RuleOverride = BINARY USE = IA32 CodeCoverageBinPkg/CodeCoveragePei/CodeCoveragePeiBin.inf
+  !else
+    INF CodeCoverageBinPkg/CodeCoveragePei/CodeCoveragePei.inf
+  !endif
+!endif
 INF  MdeModulePkg/Core/DxeIplPeim/DxeIpl.inf
 
 FILE FV_IMAGE = A4EF5A93-3F1B-4232-A1C4-F0910E6D1D9C {
@@ -133,6 +140,12 @@
   }
 }
 
+!ifdef $(ENCOV)
+#PCD(gCodeCoverageBinPkgTokenSpaceGuid.PcdCovDxeFileName)
+FILE FREEFORM = B352076F-31A4-47ee-8919-A1B1C41B99BD{
+    SECTION RAW = CodeCoverageBinPkg/Config/Edk2Cov.ucda
+  }
+!endif
 ################################################################################
 
 [FV.DXEFV]
@@ -155,6 +168,13 @@
 READ_LOCK_STATUS   = TRUE
 
 APRIORI DXE {
+!ifdef $(ENCOV)
+  !ifdef $(BINARY_ONLY)
+  INF  RuleOverride = BINARY USE = IA32 CodeCoverageBinPkg/CodeCoverageDxe/CodeCoverageDxeBin.inf
+  !else
+  INF CodeCoverageBinPkg/CodeCoverageDxe/CodeCoverageDxe.inf
+  !endif
+!endif
   INF  MdeModulePkg/Universal/PCD/Dxe/Pcd.inf
 }
 
@@ -162,7 +182,15 @@
 # DXE Phase modules
 #
 INF  MdeModulePkg/Core/Dxe/DxeMain.inf
-
+!ifdef $(ENCOV)
+  !ifdef $(BINARY_ONLY)
+    INF  RuleOverride = BINARY USE = IA32 CodeCoverageBinPkg/CodeCoverageDxe/CodeCoverageDxeBin.inf
+    INF  RuleOverride = BINARY USE = IA32 CodeCoverageBinPkg/CovResetSystem/CovResetSystemBin.inf
+  !else
+    INF  CodeCoverageBinPkg/CodeCoverageDxe/CodeCoverageDxe.inf
+    INF  CodeCoverageBinPkg/CovResetSystem/CovResetSystem.inf
+  !endif
+!endif
 INF  IntelFrameworkModulePkg/Universal/StatusCode/RuntimeDxe/StatusCodeRuntimeDxe.inf
 INF  MdeModulePkg/Universal/PCD/Dxe/Pcd.inf
 
@@ -367,6 +395,25 @@
     VERSION  STRING="$(INF_VERSION)" Optional BUILD_NUM=$(BUILD_NUMBER)
   }
 
+!ifdef $(ENCOV)
+  !ifdef $(BINARY_ONLY)
+[Rule.Common.PEIM.BINARY]
+  FILE PEIM = $(NAMED_GUID)               {
+     PEI_DEPEX PEI_DEPEX Optional        |.depex
+     PE32      PE32    Align=Auto        |.efi
+     UI        STRING="$(MODULE_NAME)" Optional
+     VERSION   STRING="$(INF_VERSION)" Optional BUILD_NUM=$(BUILD_NUMBER)
+  }
+
+[Rule.Common.DXE_RUNTIME_DRIVER.BINARY]
+  FILE DRIVER = $(NAMED_GUID) {
+    DXE_DEPEX DXE_DEPEX Optional       |.depex
+    PE32      PE32                     |.efi
+    UI        STRING="$(MODULE_NAME)" Optional
+    VERSION   STRING="$(INF_VERSION)" Optional BUILD_NUM=$(BUILD_NUMBER)
+  }
+  !endif
+!endif
 [Rule.Common.UEFI_DRIVER.BINARY]
   FILE DRIVER = $(NAMED_GUID) {
     DXE_DEPEX DXE_DEPEX Optional      |.depex
